<!--
 * @Author: your name
 * @Date: 2021-05-25 22:02:57
 * @LastEditTime: 2021-05-26 19:28:51
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \rewrite\Vue\Vue3\HelloVue3.html
-->
<div id="app">
  <h1>{{title}}</h1>
  <!-- <h1>{{state.title}}</h1> -->
</div>

<script>
  // createApp 返回的应用程序实例是什么样子的
  const Vue = {
    createApp(options) {
      // 返回就是app实例
      return {
        mount(selector) {
          // mount 的目标是什么?
          const parent = document.querySelector(selector)
          // 将组件的配置解析为dom
          // 通过render 函数
          if (!options.render) {
            options.render = this.compile(parent.innerHTML)
          }

          // 兼容options api
          if (options.setup) {
            this.setupState = options.setup()
          } else {
            this.data = options.data()
          }

          // Proxy
          // 确定render中数据如何获取
          this.proxy = new Proxy(this, {
            get(target, key) {
              if (key in target.setupState) {
                return target.setupState[key]
              } else {
                return target.data[key]
              }
            },
            set(target, key, val) {
              if (key in target.setupState) {
                target.setupState[key] = val
              } else {
                target.data[key] = val
              }
            }
          })

          const el = options.render.call(this.proxy)
          // 追加到宿主元素中去
          parent.innerHTML = ''
          parent.appendChild(el)
        },
        compile(template) {
          // 没有用到template 解析 硬编码
          return function render() {
            const h3 = document.createElement('h3')
            h3.textContent = this.title
            return h3
          }
        }
      }
    }
  }
</script>
<script>
  // 1. 函数式： 类型支持更好 ts
  // 2. 标准化、简化 一致性
  // 3. tree-shaking 
  // 4. 复用性 composition api
  // 5. 性能优化 编译期的优化
  // 6. 扩展性：自定义渲染器
  const app = Vue.createApp({
    data() {
      return {
        title: 'Hello Vue3'
      }
    },
    setup() {
      // 规避this
      return {
        title: 'hello vue3!!!!!!!!!!!'
      }
    }
  })

  app.mount('#app')
</script>